{% extends "base.html" %}

{% block title %}Design Gallery - {{ request.company_name }} - TezzaWorks{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-12">
    <!-- Header -->
    <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
            {{ request.company_name }}
        </h1>
        <p class="text-xl text-gray-600">Your Custom Design Gallery</p>

        {% if request.status == 'pending' %}
            <div class="mt-6 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 max-w-2xl mx-auto">
                <p class="font-bold"><i class="fas fa-hourglass-half mr-2"></i>Design In Progress</p>
                <p class="text-sm">We're working on your custom designs. Check back soon!</p>
            </div>
        {% elif request.status == 'in_progress' %}
            <div class="mt-6 bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 max-w-2xl mx-auto">
                <p class="font-bold"><i class="fas fa-paintbrush mr-2"></i>Designs Coming Soon</p>
                <p class="text-sm">Your custom options are being finalized. We'll notify you when they're ready!</p>
            </div>
        {% endif %}
    </div>

    <!-- Brand Keywords Display -->
    <div class="max-w-4xl mx-auto mb-12">
        <div class="bg-white rounded-lg card-shadow p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-tag mr-3 text-purple-600"></i>
                Your Brand Profile
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <p class="text-sm font-semibold text-gray-600 mb-2">Brand Keywords:</p>
                    <p class="text-gray-800">{{ request.brand_keywords }}</p>
                </div>
                {% if request.brand_colors %}
                <div>
                    <p class="text-sm font-semibold text-gray-600 mb-2">Brand Colors:</p>
                    <p class="text-gray-800">{{ request.brand_colors }}</p>
                </div>
                {% endif %}
                {% if request.target_audience %}
                <div>
                    <p class="text-sm font-semibold text-gray-600 mb-2">Target Audience:</p>
                    <p class="text-gray-800">{{ request.target_audience }}</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Design Gallery -->
    {% if designs %}
    <div class="max-w-6xl mx-auto mb-12">
        <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">
            <i class="fas fa-images mr-2 text-purple-600"></i>
            Your Design Options
        </h2>

        <form action="{{ url_for('client.submit_feedback', token=request.gallery_token) }}" method="POST">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                {% for design in designs %}
                <div class="bg-white rounded-lg card-shadow overflow-hidden hover:shadow-xl transition duration-200">
                    <!-- Design Image -->
                    <div class="relative group">
                        <img src="{{ url_for('static', filename='uploads/' + design.filename) }}"
                             alt="{{ design.title or 'Design Option' }}"
                             class="w-full h-80 object-cover cursor-pointer"
                             onclick="openModal('{{ url_for('static', filename='uploads/' + design.filename) }}', '{{ design.title or 'Design Option' }}')">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition duration-200 flex items-center justify-center">
                            <i class="fas fa-search-plus text-white text-3xl opacity-0 group-hover:opacity-100 transition duration-200"></i>
                        </div>
                    </div>

                    <!-- Design Info -->
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-2">
                            {{ design.title or 'Design Option ' ~ loop.index }}
                        </h3>
                        {% if design.description %}
                        <p class="text-gray-600 mb-4">{{ design.description }}</p>
                        {% endif %}

                        <!-- Selection Checkbox -->
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox"
                                   name="selected_designs[]"
                                   value="{{ design.id }}"
                                   {% if design.is_selected %}checked{% endif %}
                                   class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-600">
                            <span class="text-gray-700 font-semibold">Select this design</span>
                        </label>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Feedback Form -->
            <div class="bg-white rounded-lg card-shadow p-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-comment-dots mr-3 text-purple-600"></i>
                    Share Your Feedback
                </h3>

                <div class="space-y-6">
                    <!-- Rating -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            Overall Satisfaction
                        </label>
                        <div class="flex space-x-2">
                            {% for i in range(1, 6) %}
                            <label class="cursor-pointer">
                                <input type="radio" name="rating" value="{{ i }}" class="hidden peer"
                                       {% if feedback and feedback.rating == i %}checked{% endif %}>
                                <i class="far fa-star text-3xl text-gray-300 peer-checked:fas peer-checked:text-yellow-400 hover:text-yellow-300 transition"></i>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Feedback Text -->
                    <div>
                        <label for="overall_feedback" class="block text-sm font-semibold text-gray-700 mb-2">
                            Additional Comments
                        </label>
                        <textarea id="overall_feedback"
                                  name="overall_feedback"
                                  rows="4"
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"
                                  placeholder="Tell us what you think about these designs, or share any additional ideas...">{{ feedback.overall_feedback if feedback else '' }}</textarea>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit"
                            class="w-full gradient-bg text-white font-bold py-4 px-6 rounded-lg hover:opacity-90 transition duration-200 flex items-center justify-center space-x-2">
                        <i class="fas fa-paper-plane"></i>
                        <span>Submit Feedback</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
    {% else %}
    <!-- No Designs Yet -->
    <div class="max-w-2xl mx-auto text-center">
        <div class="bg-white rounded-lg card-shadow p-12">
            <i class="fas fa-palette text-6xl text-gray-300 mb-6"></i>
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Designs Coming Soon</h3>
            <p class="text-gray-600 mb-6">
                Our design team is working hard to create custom options for your brand.
                We'll notify you by email once your designs are ready to view.
            </p>
            <p class="text-sm text-gray-500">
                <i class="fas fa-bookmark mr-2"></i>
                Bookmark this page to check back anytime!
            </p>
        </div>
    </div>
    {% endif %}

    <!-- Contact Section -->
    <div class="max-w-2xl mx-auto text-center mt-12">
        <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-3">
                Questions or Need Changes?
            </h3>
            <p class="text-gray-600 mb-4">
                Our team is here to help you find the perfect design.
            </p>
            <div class="flex justify-center space-x-6">
                <a href="mailto:info@tezzaworks.com" class="text-purple-600 hover:text-purple-700 font-semibold">
                    <i class="fas fa-envelope mr-2"></i>info@tezzaworks.com
                </a>
                <span class="text-gray-400">|</span>
                <a href="tel:5551234567" class="text-purple-600 hover:text-purple-700 font-semibold">
                    <i class="fas fa-phone mr-2"></i>(555) 123-4567
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50" onclick="closeModal()">
    <div class="max-w-4xl max-h-screen p-4">
        <img id="modalImage" src="" alt="" class="max-w-full max-h-full rounded-lg">
        <p id="modalTitle" class="text-white text-center mt-4 text-xl font-bold"></p>
    </div>
    <button onclick="closeModal()" class="absolute top-4 right-4 text-white text-4xl hover:text-gray-300">
        <i class="fas fa-times"></i>
    </button>
</div>

<script>
function openModal(imageSrc, title) {
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const modalTitle = document.getElementById('modalTitle');

    modalImage.src = imageSrc;
    modalTitle.textContent = title;
    modal.classList.remove('hidden');
    modal.classList.add('flex');
}

function closeModal() {
    const modal = document.getElementById('imageModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
}

// Close modal on Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeModal();
    }
});
</script>
{% endblock %}
